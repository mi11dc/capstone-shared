import { Injectable } from '@angular/core';
import { HttpParams, HttpHeaders } from '@angular/common/http';
import { retry, shareReplay } from 'rxjs/operators';
import { environment } from '../../../environments/environment';
import * as i0 from "@angular/core";
import * as i1 from "@angular/common/http";
export class ApiService {
    http;
    constructor(http) {
        this.http = http;
    }
    get(path, queryParms, baseUrl = environment.baseURL) {
        let httpParams;
        let httpHeaders = new HttpHeaders();
        Object.keys(queryParms).forEach(key => {
            if (key === 'headers') {
                Object.keys(queryParms.headers).forEach(hkey => {
                    if (queryParms.headers[hkey] !== null && queryParms.headers[hkey] !== '') {
                        // tslint:disable-next-line: quotemark
                        httpHeaders = httpHeaders.set(hkey, queryParms.headers[hkey]);
                    }
                });
            }
            else {
                httpParams = this.getQueryParams(queryParms);
            }
        });
        return this.http
            .get(`${baseUrl + path}`, {
            headers: httpHeaders,
            observe: 'response',
            params: httpParams
        })
            .pipe(retry(1), shareReplay());
    }
    getSingle(path, httpHeaders = {}, baseUrl = environment.baseURL) {
        return this.http.get(`${baseUrl + path}`, { headers: httpHeaders, observe: 'response' }).pipe(retry(1), shareReplay());
    }
    post(path, requestObject, httpHeaders = {}, baseUrl = environment.baseURL) {
        return this.http
            .post(`${baseUrl + path}`, requestObject, {
            headers: httpHeaders,
            observe: 'response'
        })
            .pipe(retry(1), shareReplay());
    }
    postFormEncoded(path, requestObject, httpHeaders = {}, baseUrl = environment.baseURL) {
        const body = new URLSearchParams();
        if (requestObject) {
            Object.keys(requestObject).forEach(obj => {
                if (requestObject[obj] !== null || requestObject[obj] !== undefined) {
                    body.set(obj, requestObject[obj]);
                }
            });
        }
        return this.http
            .post(`${baseUrl + path}`, body.toString(), { headers: { 'Content-Type': 'application/x-www-form-urlencoded' }, observe: 'response' })
            .pipe(retry(1), shareReplay());
    }
    uploadFile(path, requestObject, baseUrl = environment.baseURL) {
        return this.http
            .post(`${baseUrl + path}`, requestObject, {
            reportProgress: true,
            observe: 'events'
        })
            .pipe(retry(1), shareReplay());
    }
    put(path, requestObject, httpHeaders = {}, baseUrl = environment.baseURL) {
        return this.http
            .put(`${baseUrl + path}`, requestObject, {
            headers: httpHeaders,
            observe: 'response'
        })
            .pipe(retry(1), shareReplay());
    }
    delete(path, httpHeaders = {}, baseUrl = environment.baseURL) {
        return this.http.delete(`${baseUrl + path}`, { headers: httpHeaders, observe: 'response' }).pipe(shareReplay());
    }
    getQueryParams(queryParams) {
        let queryString = new HttpParams();
        Object.keys(queryParams).forEach(param => {
            if (param !== 'headers') {
                if (queryParams[param] !== null && queryParams[param] !== '') {
                    const value = queryParams[param].toString().trim();
                    queryString = queryString.append(param, value);
                }
            }
        });
        return queryString;
    }
    static ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "16.2.6", ngImport: i0, type: ApiService, deps: [{ token: i1.HttpClient }], target: i0.ɵɵFactoryTarget.Injectable });
    static ɵprov = i0.ɵɵngDeclareInjectable({ minVersion: "12.0.0", version: "16.2.6", ngImport: i0, type: ApiService });
}
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "16.2.6", ngImport: i0, type: ApiService, decorators: [{
            type: Injectable
        }], ctorParameters: function () { return [{ type: i1.HttpClient }]; } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYXBpLnNlcnZpY2UuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi8uLi9zcmMvYXBwL2NvcmUvc2VydmljZXMvYXBpLnNlcnZpY2UudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUFFLFVBQVUsRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUMzQyxPQUFPLEVBQWMsVUFBVSxFQUFFLFdBQVcsRUFBRSxNQUFNLHNCQUFzQixDQUFDO0FBRTNFLE9BQU8sRUFBRSxLQUFLLEVBQUUsV0FBVyxFQUFjLE1BQU0sZ0JBQWdCLENBQUM7QUFDaEUsT0FBTyxFQUFFLFdBQVcsRUFBRSxNQUFNLG1DQUFtQyxDQUFDOzs7QUFHaEUsTUFBTSxPQUFPLFVBQVU7SUFDQztJQUFwQixZQUFvQixJQUFnQjtRQUFoQixTQUFJLEdBQUosSUFBSSxDQUFZO0lBQUcsQ0FBQztJQUVqQyxHQUFHLENBQ04sSUFBWSxFQUNaLFVBQWUsRUFDZixVQUFrQixXQUFXLENBQUMsT0FBTztRQUVyQyxJQUFJLFVBQXNCLENBQUM7UUFDM0IsSUFBSSxXQUFXLEdBQWdCLElBQUksV0FBVyxFQUFFLENBQUM7UUFDakQsTUFBTSxDQUFDLElBQUksQ0FBQyxVQUFVLENBQUMsQ0FBQyxPQUFPLENBQUMsR0FBRyxDQUFDLEVBQUU7WUFDdEMsSUFBSSxHQUFHLEtBQUssU0FBUyxFQUFFO2dCQUNuQixNQUFNLENBQUMsSUFBSSxDQUFDLFVBQVUsQ0FBQyxPQUFPLENBQUMsQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLEVBQUU7b0JBQzNDLElBQUksVUFBVSxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsS0FBSyxJQUFJLElBQUksVUFBVSxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsS0FBSyxFQUFFLEVBQUU7d0JBQ3RFLHNDQUFzQzt3QkFDdEMsV0FBVyxHQUFHLFdBQVcsQ0FBQyxHQUFHLENBQUMsSUFBSSxFQUFFLFVBQVUsQ0FBQyxPQUFPLENBQUMsSUFBSSxD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V0FBVyxDQUFDO0lBQ3ZCLENBQUM7dUdBdklRLFVBQVU7MkdBQVYsVUFBVTs7MkZBQVYsVUFBVTtrQkFEdEIsVUFBVSIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEluamVjdGFibGUgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcclxuaW1wb3J0IHsgSHR0cENsaWVudCwgSHR0cFBhcmFtcywgSHR0cEhlYWRlcnMgfSBmcm9tICdAYW5ndWxhci9jb21tb24vaHR0cCc7XHJcbmltcG9ydCB7IE9ic2VydmFibGUsIG9mIH0gZnJvbSAncnhqcyc7XHJcbmltcG9ydCB7IHJldHJ5LCBzaGFyZVJlcGxheSwgY2F0Y2hFcnJvciB9IGZyb20gJ3J4anMvb3BlcmF0b3JzJztcclxuaW1wb3J0IHsgZW52aXJvbm1lbnQgfSBmcm9tICcuLi8uLi8uLi9lbnZpcm9ubWVudHMvZW52aXJvbm1lbnQnO1xyXG5cclxuQEluamVjdGFibGUoKVxyXG5leHBvcnQgY2xhc3MgQXBpU2VydmljZSB7XHJcbiAgICBjb25zdHJ1Y3Rvcihwcml2YXRlIGh0dHA6IEh0dHBDbGllbnQpIHt9XHJcblxyXG4gICAgcHVibGljIGdldChcclxuICAgICAgICBwYXRoOiBzdHJpbmcsXHJcbiAgICAgICAgcXVlcnlQYXJtczogYW55LFxyXG4gICAgICAgIGJhc2VVcmw6IHN0cmluZyA9IGVudmlyb25tZW50LmJhc2VVUkxcclxuICAgICk6IE9ic2VydmFibGU8YW55PiB7XHJcbiAgICAgICAgbGV0IGh0dHBQYXJhbXM6IEh0dHBQYXJhbXM7XHJcbiAgICAgICAgbGV0IGh0dHBIZWFkZXJzOiBIdHRwSGVhZGVycyA9IG5ldyBIdHRwSGVhZGVycygpO1xyXG4gICAgICAgIE9iamVjdC5rZXlzKHF1ZXJ5UGFybXMpLmZvckVhY2goa2V5ID0+IHtcclxuICAgICAgICBpZiAoa2V5ID09PSAnaGVhZGVycycpIHtcclxuICAgICAgICAgICAgT2JqZWN0LmtleXMocXVlcnlQYXJtcy5oZWFkZXJzKS5mb3JFYWNoKGhrZXkgPT4ge1xyXG4gICAgICAgICAgICAgICAgaWYgKHF1ZXJ5UGFybXMuaGVhZGVyc1toa2V5XSAhPT0gbnVsbCAmJiBxdWVyeVBhcm1zLmhlYWRlcnNbaGtleV0gIT09ICcnKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgLy8gdHNsaW50OmRpc2FibGUtbmV4dC1saW5lOiBxdW90ZW1hcmtcclxuICAgICAgICAgICAgICAgICAgICBodHRwSGVhZGVycyA9IGh0dHBIZWFkZXJzLnNldChoa2V5LCBxdWVyeVBhcm1zLmhlYWRlcnNbaGtleV0pO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICBodHRwUGFyYW1zID0gdGhpcy5nZXRRdWVyeVBhcmFtcyhxdWVyeVBhcm1zKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuaHR0cFxyXG4gICAgICAgICAgICAuZ2V0KGAke2Jhc2VVcmwgKyBwYXRofWAsIHtcclxuICAgICAgICAgICAgICAgIGhlYWRlcnM6IGh0dHBIZWFkZXJzLFxyXG4gICAgICAgICAgICAgICAgb2JzZXJ2ZTogJ3Jlc3BvbnNlJyxcclxuICAgICAgICAgICAgICAgIHBhcmFtczogaHR0cFBhcmFtc1xyXG4gICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAucGlwZShcclxuICAgICAgICAgICAgICAgIHJldHJ5KDEpLFxyXG4gICAgICAgICAgICAgICAgc2hhcmVSZXBsYXkoKVxyXG4gICAgICAgICAgICApO1xyXG4gICAgfVxyXG4gICAgcHVibGljIGdldFNpbmdsZShcclxuICAgICAgICBwYXRoOiBzdHJpbmcsXHJcbiAgICAgICAgaHR0cEhlYWRlcnM6IGFueSA9IHt9LFxyXG4gICAgICAgIGJhc2VVcmw6IHN0cmluZyA9IGVudmlyb25tZW50LmJhc2VVUkxcclxuICAgICk6IE9ic2VydmFibGU8YW55PiB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuaHR0cC5nZXQoYCR7YmFzZVVybCArIHBhdGh9YCwgeyBoZWFkZXJzOiBodHRwSGVhZGVycywgb2JzZXJ2ZTogJ3Jlc3BvbnNlJyB9KS5waXBlKFxyXG4gICAgICAgICAgICByZXRyeSgxKSxcclxuICAgICAgICAgICAgc2hhcmVSZXBsYXkoKVxyXG4gICAgICAgICk7XHJcbiAgICB9XHJcbiAgICBwdWJsaWMgcG9zdChcclxuICAgICAgICBwYXRoOiBzdHJpbmcsXHJcbiAgICAgICAgcmVxdWVzdE9iamVjdDogYW55LFxyXG4gICAgICAgIGh0dHBIZWFkZXJzOiBhbnkgPSB7fSxcclxuICAgICAgICBiYXNlVXJsOiBzdHJpbmcgPSBlbnZpcm9ubWVudC5iYXNlVVJMXHJcbiAgICApOiBPYnNlcnZhYmxlPGFueT4ge1xyXG4gICAgICAgIHJldHVybiB0aGlzLmh0dHBcclxuICAgICAgICAucG9zdChgJHtiYXNlVXJsICsgcGF0aH1gLCByZXF1ZXN0T2JqZWN0LCB7XHJcbiAgICAgICAgICAgIGhlYWRlcnM6IGh0dHBIZWFkZXJzLFxyXG4gICAgICAgICAgICBvYnNlcnZlOiAncmVzcG9uc2UnXHJcbiAgICAgICAgfSlcclxuICAgICAgICAucGlwZShcclxuICAgICAgICAgICAgcmV0cnkoMSksXHJcbiAgICAgICAgICAgIHNoYXJlUmVwbGF5KClcclxuICAgICAgICApO1xyXG4gICAgfVxyXG5cclxuICAgIHB1YmxpYyBwb3N0Rm9ybUVuY29kZWQoXHJcbiAgICAgICAgcGF0aDogc3RyaW5nLFxyXG4gICAgICAgIHJlcXVlc3RPYmplY3Q6IGFueSxcclxuICAgICAgICBodHRwSGVhZGVyczogYW55ID0ge30sXHJcbiAgICAgICAgYmFzZVVybDogc3RyaW5nID0gZW52aXJvbm1lbnQuYmFzZVVSTFxyXG4gICAgKTogT2JzZXJ2YWJsZTxhbnk+IHtcclxuICAgICAgICBjb25zdCBib2R5ID0gIG5ldyBVUkxTZWFyY2hQYXJhbXMoKTtcclxuICAgICAgICBpZiAocmVxdWVzdE9iamVjdCkge1xyXG4gICAgICAgICAgICBPYmplY3Qua2V5cyhyZXF1ZXN0T2JqZWN0KS5mb3JFYWNoKG9iaiA9PiB7XHJcbiAgICAgICAgICAgICAgICBpZiAocmVxdWVzdE9iamVjdFtvYmpdICE9PSBudWxsIHx8IHJlcXVlc3RPYmplY3Rbb2JqXSAhPT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgICAgICAgICBib2R5LnNldChvYmosIHJlcXVlc3RPYmplY3Rbb2JqXSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gdGhpcy5odHRwXHJcbiAgICAgICAgLnBvc3QoYCR7YmFzZVVybCArIHBhdGh9YCwgYm9keS50b1N0cmluZygpLCB7IGhlYWRlcnM6IHsnQ29udGVudC1UeXBlJzogJ2FwcGxpY2F0aW9uL3gtd3d3LWZvcm0tdXJsZW5jb2RlZCd9LCBvYnNlcnZlOiAncmVzcG9uc2UnIH0pXHJcbiAgICAgICAgLnBpcGUoXHJcbiAgICAgICAgICAgIHJldHJ5KDEpLFxyXG4gICAgICAgICAgICBzaGFyZVJlcGxheSgpXHJcbiAgICAgICAgKTtcclxuICAgIH1cclxuXHJcbiAgICBwdWJsaWMgdXBsb2FkRmlsZShcclxuICAgICAgICBwYXRoOiBzdHJpbmcsXHJcbiAgICAgICAgcmVxdWVzdE9iamVjdDogYW55LFxyXG4gICAgICAgIGJhc2VVcmw6IHN0cmluZyA9IGVudmlyb25tZW50LmJhc2VVUkxcclxuICAgICk6IE9ic2VydmFibGU8YW55PiB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuaHR0cFxyXG4gICAgICAgIC5wb3N0KGAke2Jhc2VVcmwgKyBwYXRofWAsIHJlcXVlc3RPYmplY3QsIHtcclxuICAgICAgICAgICAgcmVwb3J0UHJvZ3Jlc3M6IHRydWUsXHJcbiAgICAgICAgICAgIG9ic2VydmU6ICdldmVudHMnXHJcbiAgICAgICAgfSlcclxuICAgICAgICAucGlwZShcclxuICAgICAgICAgICAgcmV0cnkoMSksXHJcbiAgICAgICAgICAgIHNoYXJlUmVwbGF5KClcclxuICAgICAgICApO1xyXG4gICAgfVxyXG5cclxuICAgIHB1YmxpYyBwdXQoXHJcbiAgICAgICAgcGF0aDogc3RyaW5nLFxyXG4gICAgICAgIHJlcXVlc3RPYmplY3Q6IGFueSxcclxuICAgICAgICBodHRwSGVhZGVyczogYW55ID0ge30sXHJcbiAgICAgICAgYmFzZVVybDogc3RyaW5nID0gZW52aXJvbm1lbnQuYmFzZVVSTFxyXG4gICAgKTogT2JzZXJ2YWJsZTxhbnk+IHtcclxuICAgICAgICByZXR1cm4gdGhpcy5odHRwXHJcbiAgICAgICAgLnB1dChgJHtiYXNlVXJsICsgcGF0aH1gLCByZXF1ZXN0T2JqZWN0LCB7XHJcbiAgICAgICAgICAgIGhlYWRlcnM6IGh0dHBIZWFkZXJzLFxyXG4gICAgICAgICAgICBvYnNlcnZlOiAncmVzcG9uc2UnXHJcbiAgICAgICAgfSlcclxuICAgICAgICAucGlwZShcclxuICAgICAgICAgICAgcmV0cnkoMSksXHJcbiAgICAgICAgICAgIHNoYXJlUmVwbGF5KClcclxuICAgICAgICApO1xyXG4gICAgfVxyXG4gICAgcHVibGljIGRlbGV0ZShcclxuICAgICAgICBwYXRoOiBzdHJpbmcsXHJcbiAgICAgICAgaHR0cEhlYWRlcnM6IGFueSA9IHt9LFxyXG4gICAgICAgIGJhc2VVcmw6IHN0cmluZyA9IGVudmlyb25tZW50LmJhc2VVUkxcclxuICAgICk6IE9ic2VydmFibGU8YW55PiB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuaHR0cC5kZWxldGUoYCR7YmFzZVVybCArIHBhdGh9YCwgeyBoZWFkZXJzOiBodHRwSGVhZGVycywgb2JzZXJ2ZTogJ3Jlc3BvbnNlJyB9KS5waXBlKFxyXG4gICAgICAgICAgICBzaGFyZVJlcGxheSgpXHJcbiAgICAgICAgKTtcclxuICAgIH1cclxuICAgIFxyXG4gICAgcHJpdmF0ZSBnZXRRdWVyeVBhcmFtcyhxdWVyeVBhcmFtczogYW55KSB7XHJcbiAgICAgICAgbGV0IHF1ZXJ5U3RyaW5nOiBIdHRwUGFyYW1zID0gbmV3IEh0dHBQYXJhbXMoKTtcclxuICAgICAgICBPYmplY3Qua2V5cyhxdWVyeVBhcmFtcykuZm9yRWFjaChwYXJhbSA9PiB7XHJcbiAgICAgICAgaWYgKHBhcmFtICE9PSAnaGVhZGVycycpIHtcclxuICAgICAgICAgICAgaWYgKHF1ZXJ5UGFyYW1zW3BhcmFtXSAhPT0gbnVsbCAmJiBxdWVyeVBhcmFtc1twYXJhbV0gIT09ICcnKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IHZhbHVlID0gcXVlcnlQYXJhbXNbcGFyYW1dLnRvU3RyaW5nKCkudHJpbSgpO1xyXG4gICAgICAgICAgICBxdWVyeVN0cmluZyA9IHF1ZXJ5U3RyaW5nLmFwcGVuZChwYXJhbSwgdmFsdWUpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIHJldHVybiBxdWVyeVN0cmluZztcclxuICAgIH1cclxufVxyXG4iXX0=